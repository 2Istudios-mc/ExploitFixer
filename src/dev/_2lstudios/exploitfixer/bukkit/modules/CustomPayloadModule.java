package dev._2lstudios.exploitfixer.bukkit.modules;

import java.util.HashMap;
import java.util.Map;

import org.bukkit.configuration.Configuration;
import org.bukkit.configuration.ConfigurationSection;
import org.bukkit.plugin.Plugin;

import dev._2lstudios.exploitfixer.bukkit.instanceables.Violations;
import dev._2lstudios.exploitfixer.bukkit.managers.ModuleManager;
import dev._2lstudios.exploitfixer.shared.interfaces.ViolationModule;

public class CustomPayloadModule implements ViolationModule {
	private Map<String, Double> multipliers = new HashMap<>();
	private Violations violations;
	private int channelAmount, dataBytes, bookBytes;
	private double cancelVls, reduceVls, bookVls, channelVls, dataVls, tagVls;
	private boolean enabled;

	public CustomPayloadModule(final Plugin plugin, final ModuleManager moduleManager, final Configuration configYml) {
		reload(configYml);
	}

	public void reload(final Configuration configYml) {
		final ConfigurationSection configurationSection = configYml
				.getConfigurationSection("custompayload.multipliers");
		final String name = getName().toLowerCase();

		this.enabled = configYml.getBoolean(name + ".enabled");
		this.cancelVls = configYml.getDouble(name + ".cancel_vls");
		this.reduceVls = configYml.getDouble(name + ".reduce_vls");
		this.bookVls = configYml.getDouble(name + ".book.vls");
		this.bookBytes = configYml.getInt(name + ".book.bytes");
		this.violations = new Violations(configYml.getConfigurationSection(name + ".violations"));
		this.channelVls = configYml.getDouble(name + ".channel.vls");
		this.channelAmount = configYml.getInt(name + ".channel.amount");
		this.dataVls = configYml.getDouble(name + ".data.vls");
		this.dataBytes = configYml.getInt(name + ".data.bytes");
		this.tagVls = configYml.getDouble(name + ".tag.vls");

		for (final String key : configurationSection.getKeys(false)) {
			multipliers.put(key, configurationSection.getDouble(key));
		}
	}

	@Override
	public double getCancelVls() {
		return cancelVls;
	}

	@Override
	public double getReduceVls() {
		return reduceVls;
	}

	@Override
	public Violations getViolations() {
		return violations;
	}

	@Override
	public String getName() {
		return "CustomPayload";
	}

	@Override
	final public boolean isEnabled() {
		return enabled;
	}

	public double getMultiplier(final String packetName) {
		return multipliers.getOrDefault(packetName, multipliers.getOrDefault("PacketPlayInOther", 1D));
	}

	public double getTagVls() {
		return this.tagVls;
	}

	public double getBookVls() {
		return this.bookVls;
	}

	public double getChannelVls() {
		return this.channelVls;
	}

	public double getDataVls() {
		return this.dataVls;
	}

	public int getBookBytes() {
		return this.bookBytes;
	}

	public int getDataBytes() {
		return this.dataBytes;
	}

	public int getChannelAmount() {
		return this.channelAmount;
	}
}
