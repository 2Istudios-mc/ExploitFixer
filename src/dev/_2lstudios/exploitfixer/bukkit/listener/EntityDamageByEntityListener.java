package dev._2lstudios.exploitfixer.bukkit.listener;

import org.bukkit.entity.Entity;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.EventPriority;
import org.bukkit.event.Listener;
import org.bukkit.event.entity.EntityDamageByEntityEvent;

import dev._2lstudios.exploitfixer.bukkit.managers.ModuleManager;
import dev._2lstudios.exploitfixer.bukkit.modules.EventsModule;
import dev._2lstudios.exploitfixer.shared.modules.NotificationsModule;

public class EntityDamageByEntityListener implements Listener {
	private final NotificationsModule notificationsModule;
	private final EventsModule eventsModule;

	EntityDamageByEntityListener(final ModuleManager moduleManager) {
		this.notificationsModule = moduleManager.getNotificationsModule();
		this.eventsModule = moduleManager.getEventsModule();
	}

	@EventHandler(priority = EventPriority.LOWEST, ignoreCancelled = true)
	public void onEntityDamageByEntity(final EntityDamageByEntityEvent event) {
		if (!eventsModule.isSelfDamage()) {
			return;
		}

		final Entity entity = event.getEntity();

		if (entity instanceof Player) {
			final Entity damager = event.getDamager();

			if (damager instanceof Player && entity == damager) {
				event.setCancelled(true);
				notificationsModule.debug("[Events] Cancelled self damage by " + entity.getName() + "!");
			}
		}
	}
}
