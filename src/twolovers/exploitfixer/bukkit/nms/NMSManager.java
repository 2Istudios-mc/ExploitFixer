package twolovers.exploitfixer.bukkit.nms;

import org.bukkit.entity.Player;

import java.lang.reflect.Field;
import java.lang.reflect.Method;

public class NMSManager {
	public static void closeChannel(final Player player) {
		try {
			final Method getHandle = player.getClass().getMethod("getHandle");
			final Object nmsPlayer = getHandle.invoke(player);
			final Field conField = nmsPlayer.getClass().getField("playerConnection");
			final Object con = conField.get(nmsPlayer);
			final Field netField = con.getClass().getField("networkManager");
			final Object net = netField.get(con);
			final Field chanField = net.getClass().getField("channel");
			final Object chan = chanField.get(net);
			final Method method = chan.getClass().getMethod("closeFuture");

			method.invoke(chan);
		} catch (final Exception e) {
			e.printStackTrace();
		}
	}
}
