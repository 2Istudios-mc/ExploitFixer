package twolovers.exploitfixer.bukkit.adapters;

import com.comphenix.protocol.PacketType;
import com.comphenix.protocol.events.ListenerPriority;
import com.comphenix.protocol.events.PacketAdapter;
import com.comphenix.protocol.events.PacketEvent;
import org.bukkit.plugin.Plugin;
import twolovers.exploitfixer.interfaces.managers.ModuleManager;
import twolovers.exploitfixer.interfaces.modules.CustomPayloadModule;
import twolovers.exploitfixer.interfaces.modules.PacketsModule;

public class CustomPayloadPacketAdapter extends PacketAdapter {
	private final PacketType packetType;
	private final CustomPayloadModule customPayloadModule;
	private final PacketsModule packetsModule;

	public CustomPayloadPacketAdapter(final Plugin plugin, final ListenerPriority listenerPriority, final PacketType packetType, final ModuleManager moduleManager) {
		super(plugin, listenerPriority, packetType);
		this.packetType = packetType;
		this.customPayloadModule = moduleManager.getCustomPayloadModule();
		this.packetsModule = moduleManager.getPacketsModule();
	}

	@Override
	public void onPacketReceiving(final PacketEvent event) {
		if (!event.isCancelled()) {
			if (customPayloadModule.isEnabled()) {
				customPayloadModule.checkPacket(event);
			}

			if (!event.isCancelled())
				packetsModule.checkPacket(event);
		}
	}
}